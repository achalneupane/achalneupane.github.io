<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Achal Neupane">

  
  
  
    
  
  <meta name="description" content="Statistics series">

  
  <link rel="alternate" hreflang="en-us" href="/achalneupane.github.io/post/quantile_regression/">

  


  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/achalneupane.github.io/css/academic.min.3072054fc61fe865aa34bcb366de141d.css">

  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-145752794-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="https://www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/achalneupane.github.io/index.webmanifest">
  <link rel="icon" type="image/png" href="/achalneupane.github.io/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/achalneupane.github.io/img/icon-192.png">

  <link rel="canonical" href="/achalneupane.github.io/post/quantile_regression/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@achalneupane">
  <meta property="twitter:creator" content="@achalneupane">
  
  <meta property="og:site_name" content="Achal Neupane">
  <meta property="og:url" content="/achalneupane.github.io/post/quantile_regression/">
  <meta property="og:title" content="Quantile Regression | Achal Neupane">
  <meta property="og:description" content="Statistics series"><meta property="og:image" content="/achalneupane.github.io/img/icon-192.png">
  <meta property="twitter:image" content="/achalneupane.github.io/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-10-18T17:26:23-05:00">
    
    <meta property="article:modified_time" content="2019-10-18T17:26:23-05:00">
  

  


  





  <title>Quantile Regression | Achal Neupane</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/achalneupane.github.io/">Achal Neupane</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/achalneupane.github.io/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/achalneupane.github.io/#impact"><span>Impact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/achalneupane.github.io/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/achalneupane.github.io/#contact"><span>Contact</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Quantile Regression</h1>

  

  
    



<meta content="2019-10-18 17:26:23 -0500 CDT" itemprop="datePublished">
<meta content="2019-10-18 17:26:23 -0500 CDT" itemprop="dateModified">

<div class="article-metadata">

  
  
  
  
  <div>
    



  <span itemprop="author name" itemtype="http://schema.org/Person"><a href="/achalneupane.github.io/authors/achal-neupane/"><strong>Achal Neupane</strong></a></span>

  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    <time>Oct 18, 2019</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    22 min read
  </span>
  

  
  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/achalneupane.github.io/post/quantile_regression/&amp;text=Quantile%20Regression" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/achalneupane.github.io/post/quantile_regression/&amp;t=Quantile%20Regression" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Quantile%20Regression&amp;body=/achalneupane.github.io/post/quantile_regression/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/achalneupane.github.io/post/quantile_regression/&amp;title=Quantile%20Regression" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Quantile%20Regression%20/achalneupane.github.io/post/quantile_regression/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/achalneupane.github.io/post/quantile_regression/&amp;title=Quantile%20Regression" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<p>Answer all questions specified on the problem and include a discussion on how your results answered/addressed the question.</p>
<p>Submit your  file with the knitted  (or knitted Word Document saved as a PDF). If you are having trouble with .rmd, let us know and we will help you, but both the .rmd and the PDF are required.</p>
<p>This file can be used as a skeleton document for your code/write up. Please follow the instructions found under Content for Formatting and Guidelines. No code should be in your PDF write-up unless stated otherwise.</p>
<p>For any question asking for plots/graphs, please do as the question asks as well as do the same but using the respective commands in the GGPLOT2 library. (So if the question asks for one plot, your results should have two plots. One produced using the given R-function and one produced from the GGPLOT2 equivalent). This doesn’t apply to questions that don’t specifically ask for a plot, however I still would encourage you to produce both.</p>
<p>You do not need to include the above statements.</p>
<p>Please do the following problems from the text book R Handbook and stated.</p>
<ol style="list-style-type: decimal">
<li><p>Consider the {} data from the {} package</p>
<ol style="list-style-type: lower-alpha">
<li><p>Review the linear model fitted to this data in Chapter 6 of the text book and report the model and findings.</p></li>
<li><p>Fit a median regression model.</p></li>
<li><p>Compare the two results.</p></li>
</ol></li>
</ol>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ───────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.1     ✔ purrr   0.3.3
## ✔ tibble  2.1.3     ✔ dplyr   0.8.3
## ✔ tidyr   1.0.0     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ──────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(gridExtra)</code></pre>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre class="r"><code>library(HSAUR3)</code></pre>
<pre><code>## Loading required package: tools</code></pre>
<pre class="r"><code>library(mboost)</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## Loading required package: stabs</code></pre>
<pre><code>## This is mboost 2.9-1. See &#39;package?mboost&#39; and &#39;news(package  = &quot;mboost&quot;)&#39;
## for a complete list of changes.</code></pre>
<pre><code>## 
## Attaching package: &#39;mboost&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     %+%</code></pre>
<pre class="r"><code>library(&quot;quantreg&quot;)</code></pre>
<pre><code>## Loading required package: SparseM</code></pre>
<pre><code>## 
## Attaching package: &#39;SparseM&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     backsolve</code></pre>
<pre class="r"><code>library(&quot;rpart&quot;)
library(&quot;TH.data&quot;)</code></pre>
<pre><code>## Loading required package: survival</code></pre>
<pre><code>## 
## Attaching package: &#39;survival&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:quantreg&#39;:
## 
##     untangle.specials</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre><code>## 
## Attaching package: &#39;TH.data&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     geyser</code></pre>
<pre><code>## The following object is masked from &#39;package:HSAUR3&#39;:
## 
##     birds</code></pre>
<pre class="r"><code>library(gamlss.data)</code></pre>
<pre><code>## 
## Attaching package: &#39;gamlss.data&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:HSAUR3&#39;:
## 
##     plasma</code></pre>
<pre><code>## The following object is masked from &#39;package:datasets&#39;:
## 
##     sleep</code></pre>
<pre class="r"><code>library(lattice)
data(clouds)
head(clouds)</code></pre>
<pre><code>##   seeding time  sne cloudcover prewetness echomotion rainfall
## 1      no    0 1.75       13.4      0.274 stationary    12.85
## 2     yes    1 2.70       37.9      1.267     moving     5.52
## 3     yes    3 4.10        3.9      0.198 stationary     6.29
## 4      no    4 2.35        5.3      0.526     moving     6.11
## 5     yes    6 4.25        7.1      0.250     moving     2.45
## 6      no    9 1.60        6.9      0.018 stationary     3.61</code></pre>
<pre class="r"><code>cat(&quot;1a. Review the linear model fitted to this data in Chapter 6&quot;)</code></pre>
<pre><code>## 1a. Review the linear model fitted to this data in Chapter 6</code></pre>
<pre class="r"><code>clouds_formula &lt;- rainfall ~ seeding + seeding:(sne + cloudcover + prewetness + echomotion) + time
clouds.lm &lt;- glm(clouds_formula, data = clouds)
summary(clouds.lm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = clouds_formula, data = clouds)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.5259  -1.1486  -0.2704   1.0401   4.3913  
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)                     -0.34624    2.78773  -0.124  0.90306   
## seedingyes                      15.68293    4.44627   3.527  0.00372 **
## time                            -0.04497    0.02505  -1.795  0.09590 . 
## seedingno:sne                    0.41981    0.84453   0.497  0.62742   
## seedingyes:sne                  -2.77738    0.92837  -2.992  0.01040 * 
## seedingno:cloudcover             0.38786    0.21786   1.780  0.09839 . 
## seedingyes:cloudcover           -0.09839    0.11029  -0.892  0.38854   
## seedingno:prewetness             4.10834    3.60101   1.141  0.27450   
## seedingyes:prewetness            1.55127    2.69287   0.576  0.57441   
## seedingno:echomotionstationary   3.15281    1.93253   1.631  0.12677   
## seedingyes:echomotionstationary  2.59060    1.81726   1.426  0.17757   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 4.860684)
## 
##     Null deviance: 222.335  on 23  degrees of freedom
## Residual deviance:  63.189  on 13  degrees of freedom
## AIC: 115.34
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<pre class="r"><code>cat(&quot;It looks like the seedingyes variable is the most significant variable in the model followed by seedingyes:sne&quot;)</code></pre>
<pre><code>## It looks like the seedingyes variable is the most significant variable in the model followed by seedingyes:sne</code></pre>
<pre class="r"><code>cat(&quot;Now we choose continous variable sne to fit our linear model&quot;)</code></pre>
<pre><code>## Now we choose continous variable sne to fit our linear model</code></pre>
<pre class="r"><code>clouds.lm &lt;- glm(rainfall ~ sne, data = clouds)
summary(clouds.lm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = rainfall ~ sne, data = clouds)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -6.4927  -2.1116   0.0556   1.2295   6.5036  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   8.7430     2.1508   4.065 0.000515 ***
## sne          -1.3695     0.6524  -2.099 0.047512 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 8.419897)
## 
##     Null deviance: 222.33  on 23  degrees of freedom
## Residual deviance: 185.24  on 22  degrees of freedom
## AIC: 123.16
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<pre class="r"><code>MSE.lm &lt;- mean((predict(clouds.lm, data = clouds)-clouds$rainfall)^2)
cat(&quot;Linear model MSE: &quot;,MSE.lm)</code></pre>
<pre><code>## Linear model MSE:  7.718239</code></pre>
<pre class="r"><code>ggplot(data=clouds, aes(x=sne, y=rainfall, col=seeding)) + geom_point() + geom_smooth(method=&#39;lm&#39;) + labs(title=&#39;Rainfall determined by suitability criterion&#39;,x=&#39;S-NE Criterion&#39;, y=&#39;Rainfall&#39;)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>cat(&quot;1b. Fit a median regression (quantile regression) model&quot;)</code></pre>
<pre><code>## 1b. Fit a median regression (quantile regression) model</code></pre>
<pre class="r"><code>median.reg &lt;- rq(rainfall ~ sne, data = clouds, tau = 0.5)
cat(&quot;Summary of the model&quot;)</code></pre>
<pre><code>## Summary of the model</code></pre>
<pre class="r"><code>summary(median.reg)</code></pre>
<pre><code>## Warning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be nonunique</code></pre>
<pre><code>## 
## Call: rq(formula = rainfall ~ sne, tau = 0.5, data = clouds)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             coefficients lower bd upper bd
## (Intercept)  8.86133      3.14768 14.86666
## sne         -1.38667     -2.46926  0.13118</code></pre>
<pre class="r"><code>cat(&quot;Summary of model with bootstrapped standard error&quot;)</code></pre>
<pre><code>## Summary of model with bootstrapped standard error</code></pre>
<pre class="r"><code>summary(median.reg, se = &quot;boot&quot; )</code></pre>
<pre><code>## 
## Call: rq(formula = rainfall ~ sne, tau = 0.5, data = clouds)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             Value    Std. Error t value  Pr(&gt;|t|)
## (Intercept)  8.86133  3.62423    2.44502  0.02295
## sne         -1.38667  1.06195   -1.30577  0.20512</code></pre>
<pre class="r"><code>MSE.mrm &lt;- mean((predict(median.reg, data = clouds, type = &quot;response&quot;)-clouds$rainfall)^2)
cat(&quot;MSE of median regression Model: &quot;,MSE.mrm)</code></pre>
<pre><code>## MSE of median regression Model:  7.722559</code></pre>
<pre class="r"><code>cat(&quot;1c. We can also plot this model to compare with previous linear model&quot;)</code></pre>
<pre><code>## 1c. We can also plot this model to compare with previous linear model</code></pre>
<pre class="r"><code>plot_linear &lt;- ggplot(data=clouds, aes(x=sne, y=rainfall, col=seeding)) + geom_point() + geom_smooth(method=&#39;lm&#39;,se=FALSE) + labs(title=&#39;Linear regression model: Rainfall\n determined by suitability criterion&#39;,x=&#39;S-NE Criterion&#39;, y=&#39;Rainfall&#39;) + theme_classic()


plot_median &lt;- ggplot(data=clouds, aes(x=sne, y=rainfall, col=seeding)) + geom_point()  + labs(title=&#39;Median regression model: Rainfall\n determined by suitability criterion&#39;,x=&#39;S-NE Criterion&#39;, y=&#39;Rainfall&#39;) + stat_quantile(quantiles=c(0.50), method=&#39;rq&#39;) + theme_classic()

grid.arrange(plot_linear, plot_median, ncol=2)</code></pre>
<pre><code>## Smoothing formula not specified. Using: y ~ x</code></pre>
<pre><code>## Smoothing formula not specified. Using: y ~ x</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<p>Discussion:</p>
<p>In addition to fitting the models asked in 1a and 1b, I used graphical methods to compare a linear regression fit vs median regression fit for 1c. As shown in the plots, a median regression model on the data splits the absence of seeding in such a way that the median regression line has a positive slope, whereas, the simple linear regression model seems to have the negative slope. This indicates that there is higher variability in the rainfall data when cloud seeding is absent. Additionally, in presence of seeding, the median regression line is not weighted by the outliers, therefore seems better at explaining the overall data due to the high variability of the rainfall variable.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Reanalyze the {} data from the {} package.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Compare the regression tree approach from chapter 9 of the textbook to median regression and summarize the different findings.</p></li>
<li><p>Choose one independent variable. For the relationship between this variable and DEXfat, create linear regression quantile models for the 25%, 50% and 75% quantiles. Plot DEXfat vs that independent variable and plot the lines from the models on the graph.</p></li>
</ol></li>
</ol>
<pre class="r"><code>data(&quot;bodyfat&quot;)
head(bodyfat)</code></pre>
<pre><code>##    age DEXfat waistcirc hipcirc elbowbreadth kneebreadth anthro3a anthro3b
## 47  57  41.68     100.0   112.0          7.1         9.4     4.42     4.95
## 48  65  43.29      99.5   116.5          6.5         8.9     4.63     5.01
## 49  59  35.41      96.0   108.5          6.2         8.9     4.12     4.74
## 50  58  22.79      72.0    96.5          6.1         9.2     4.03     4.48
## 51  60  36.42      89.5   100.5          7.1        10.0     4.24     4.68
## 52  61  24.13      83.5    97.0          6.5         8.8     3.55     4.06
##    anthro3c anthro4
## 47     4.50    6.13
## 48     4.48    6.37
## 49     4.60    5.82
## 50     3.91    5.66
## 51     4.15    5.91
## 52     3.64    5.14</code></pre>
<pre class="r"><code>ncol(bodyfat)</code></pre>
<pre><code>## [1] 10</code></pre>
<pre class="r"><code>nrow(bodyfat)</code></pre>
<pre><code>## [1] 71</code></pre>
<pre class="r"><code>library(&quot;rpart&quot;)
# ?bodyfat

cat(&quot;First, fit regression tree model&quot;)</code></pre>
<pre><code>## First, fit regression tree model</code></pre>
<pre class="r"><code>#bodyfat_formula &lt;- DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + kneebreadth
bodyfat_rp  &lt;- rpart(DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + kneebreadth, data = bodyfat, control = rpart.control(minsplit=10))
summary(bodyfat_rp)</code></pre>
<pre><code>## Call:
## rpart(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
##     kneebreadth, data = bodyfat, control = rpart.control(minsplit = 10))
##   n= 71 
## 
##           CP nsplit  rel error    xerror       xstd
## 1 0.66289544      0 1.00000000 1.0149614 0.16976190
## 2 0.09376252      1 0.33710456 0.4071906 0.09251759
## 3 0.07703606      2 0.24334204 0.4135264 0.08910155
## 4 0.04507506      3 0.16630598 0.2974999 0.05920879
## 5 0.01844561      4 0.12123092 0.2640916 0.05859875
## 6 0.01818982      5 0.10278532 0.2665689 0.06079305
## 7 0.01000000      6 0.08459549 0.2558127 0.06188322
## 
## Variable importance
##    waistcirc      hipcirc  kneebreadth elbowbreadth          age 
##           34           30           24            7            4 
## 
## Node number 1: 71 observations,    complexity param=0.6628954
##   mean=30.78282, MSE=120.2251 
##   left son=2 (40 obs) right son=3 (31 obs)
##   Primary splits:
##       waistcirc    &lt; 88.4   to the left,  improve=0.6628954, (0 missing)
##       hipcirc      &lt; 108.25 to the left,  improve=0.6254333, (0 missing)
##       kneebreadth  &lt; 9.35   to the left,  improve=0.5142133, (0 missing)
##       age          &lt; 40.5   to the left,  improve=0.1570344, (0 missing)
##       elbowbreadth &lt; 6.55   to the left,  improve=0.1169918, (0 missing)
##   Surrogate splits:
##       hipcirc      &lt; 107.85 to the left,  agree=0.915, adj=0.806, (0 split)
##       kneebreadth  &lt; 9.35   to the left,  agree=0.831, adj=0.613, (0 split)
##       elbowbreadth &lt; 6.55   to the left,  agree=0.648, adj=0.194, (0 split)
##       age          &lt; 47     to the left,  agree=0.592, adj=0.065, (0 split)
## 
## Node number 2: 40 observations,    complexity param=0.07703606
##   mean=22.92375, MSE=32.88394 
##   left son=4 (17 obs) right son=5 (23 obs)
##   Primary splits:
##       hipcirc      &lt; 96.25  to the left,  improve=0.4999238, (0 missing)
##       waistcirc    &lt; 71.5   to the left,  improve=0.4408508, (0 missing)
##       kneebreadth  &lt; 9.15   to the left,  improve=0.3123752, (0 missing)
##       age          &lt; 41     to the left,  improve=0.2212005, (0 missing)
##       elbowbreadth &lt; 6.65   to the left,  improve=0.0757275, (0 missing)
##   Surrogate splits:
##       waistcirc    &lt; 71.5   to the left,  agree=0.775, adj=0.471, (0 split)
##       age          &lt; 41     to the left,  agree=0.700, adj=0.294, (0 split)
##       kneebreadth  &lt; 8.25   to the left,  agree=0.675, adj=0.235, (0 split)
##       elbowbreadth &lt; 5.75   to the left,  agree=0.600, adj=0.059, (0 split)
## 
## Node number 3: 31 observations,    complexity param=0.09376252
##   mean=40.92355, MSE=50.39231 
##   left son=6 (28 obs) right son=7 (3 obs)
##   Primary splits:
##       kneebreadth  &lt; 11.15  to the left,  improve=0.51233840, (0 missing)
##       hipcirc      &lt; 109.9  to the left,  improve=0.45671770, (0 missing)
##       waistcirc    &lt; 106    to the left,  improve=0.44843720, (0 missing)
##       elbowbreadth &lt; 6.35   to the left,  improve=0.16017880, (0 missing)
##       age          &lt; 45.5   to the right, improve=0.06131694, (0 missing)
## 
## Node number 4: 17 observations,    complexity param=0.01844561
##   mean=18.20765, MSE=16.81845 
##   left son=8 (11 obs) right son=9 (6 obs)
##   Primary splits:
##       age          &lt; 59.5   to the left,  improve=0.55069560, (0 missing)
##       waistcirc    &lt; 70.35  to the left,  improve=0.39973880, (0 missing)
##       elbowbreadth &lt; 6.65   to the left,  improve=0.22215850, (0 missing)
##       hipcirc      &lt; 92.6   to the left,  improve=0.16823720, (0 missing)
##       kneebreadth  &lt; 8.55   to the left,  improve=0.08112073, (0 missing)
##   Surrogate splits:
##       elbowbreadth &lt; 6.55   to the left,  agree=0.824, adj=0.500, (0 split)
##       waistcirc    &lt; 71.5   to the left,  agree=0.765, adj=0.333, (0 split)
## 
## Node number 5: 23 observations,    complexity param=0.01818982
##   mean=26.40957, MSE=16.16806 
##   left son=10 (13 obs) right son=11 (10 obs)
##   Primary splits:
##       waistcirc    &lt; 80.75  to the left,  improve=0.41753840, (0 missing)
##       hipcirc      &lt; 101.35 to the left,  improve=0.34272770, (0 missing)
##       kneebreadth  &lt; 9.5    to the left,  improve=0.30544320, (0 missing)
##       elbowbreadth &lt; 7.1    to the right, improve=0.06644785, (0 missing)
##       age          &lt; 57     to the right, improve=0.03572739, (0 missing)
##   Surrogate splits:
##       hipcirc      &lt; 101.75 to the left,  agree=0.783, adj=0.5, (0 split)
##       kneebreadth  &lt; 9.5    to the left,  agree=0.696, adj=0.3, (0 split)
##       age          &lt; 66     to the left,  agree=0.652, adj=0.2, (0 split)
##       elbowbreadth &lt; 6.25   to the left,  agree=0.652, adj=0.2, (0 split)
## 
## Node number 6: 28 observations,    complexity param=0.04507506
##   mean=39.26036, MSE=21.98307 
##   left son=12 (13 obs) right son=13 (15 obs)
##   Primary splits:
##       hipcirc      &lt; 109.9  to the left,  improve=0.62509140, (0 missing)
##       waistcirc    &lt; 99     to the left,  improve=0.47879840, (0 missing)
##       kneebreadth  &lt; 9.85   to the left,  improve=0.28389460, (0 missing)
##       elbowbreadth &lt; 6.35   to the left,  improve=0.18101920, (0 missing)
##       age          &lt; 49.5   to the right, improve=0.04758482, (0 missing)
##   Surrogate splits:
##       waistcirc    &lt; 99     to the left,  agree=0.821, adj=0.615, (0 split)
##       elbowbreadth &lt; 6.45   to the left,  agree=0.714, adj=0.385, (0 split)
##       kneebreadth  &lt; 9.95   to the left,  agree=0.714, adj=0.385, (0 split)
##       age          &lt; 49.5   to the right, agree=0.607, adj=0.154, (0 split)
## 
## Node number 7: 3 observations
##   mean=56.44667, MSE=48.76009 
## 
## Node number 8: 11 observations
##   mean=15.96, MSE=8.818582 
## 
## Node number 9: 6 observations
##   mean=22.32833, MSE=5.242981 
## 
## Node number 10: 13 observations
##   mean=24.13077, MSE=9.046699 
## 
## Node number 11: 10 observations
##   mean=29.372, MSE=9.899016 
## 
## Node number 12: 13 observations
##   mean=35.27846, MSE=10.48431 
## 
## Node number 13: 15 observations
##   mean=42.71133, MSE=6.297998</code></pre>
<pre class="r"><code>cat(&quot;Plot the regression tree model&quot;)</code></pre>
<pre><code>## Plot the regression tree model</code></pre>
<pre class="r"><code>library(partykit)</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: libcoin</code></pre>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre><code>## 
## Attaching package: &#39;partykit&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:mboost&#39;:
## 
##     varimp</code></pre>
<pre class="r"><code>plot(as.party(bodyfat_rp), tp_args = list(id=FALSE), main = &quot;Regression tree of the model&quot;)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>cat(&quot;Print CP-table&quot;)</code></pre>
<pre><code>## Print CP-table</code></pre>
<pre class="r"><code>print(bodyfat_rp$cptable)</code></pre>
<pre><code>##           CP nsplit  rel error    xerror       xstd
## 1 0.66289544      0 1.00000000 1.0149614 0.16976190
## 2 0.09376252      1 0.33710456 0.4071906 0.09251759
## 3 0.07703606      2 0.24334204 0.4135264 0.08910155
## 4 0.04507506      3 0.16630598 0.2974999 0.05920879
## 5 0.01844561      4 0.12123092 0.2640916 0.05859875
## 6 0.01818982      5 0.10278532 0.2665689 0.06079305
## 7 0.01000000      6 0.08459549 0.2558127 0.06188322</code></pre>
<pre class="r"><code>cat(&quot;CP value with lowest xerror&quot;)</code></pre>
<pre><code>## CP value with lowest xerror</code></pre>
<pre class="r"><code>min.cp &lt;- which.min(bodyfat_rp$cptable[,&#39;xerror&#39;])
min.cp</code></pre>
<pre><code>## 7 
## 7</code></pre>
<pre class="r"><code>cat(
  &quot;Following the methods in the book, we can fit the model\n using lowest xerror rate from CP for prunning tree model&quot;
)</code></pre>
<pre><code>## Following the methods in the book, we can fit the model
##  using lowest xerror rate from CP for prunning tree model</code></pre>
<pre class="r"><code>#extract the lowest CP
cp &lt;- bodyfat_rp$cptable[min.cp, &#39;CP&#39;]
bodyfat_prune &lt;- prune(bodyfat_rp, cp=cp)

cat(&quot;summary of the median regression model&quot;)</code></pre>
<pre><code>## summary of the median regression model</code></pre>
<pre class="r"><code>#Median Regression model
bodyfat_rpart_qrm &lt;- rq(DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + kneebreadth, data=bodyfat, tau = 0.50)
summary(bodyfat_rpart_qrm)</code></pre>
<pre><code>## 
## Call: rq(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
##     kneebreadth, tau = 0.5, data = bodyfat)
## 
## tau: [1] 0.5
## 
## Coefficients:
##              coefficients lower bd  upper bd 
## (Intercept)  -57.30032    -87.22119 -36.39320
## age            0.06839     -0.04338   0.14943
## waistcirc      0.28332      0.07991   0.48638
## hipcirc        0.51073      0.21307   0.75030
## elbowbreadth  -0.11982     -3.62882   2.18220
## kneebreadth    0.76453     -2.30145   2.33329</code></pre>
<pre class="r"><code>bodyfat_rpart_qrm_summary &lt;- summary(bodyfat_rpart_qrm) 


#Predict Pruned regression tree model on the bodyfat data set
RegressionTree &lt;- predict(bodyfat_prune, data=bodyfat)

#Create observed value and the predicted value
observed &lt;- bodyfat$DEXfat
predict &lt;- RegressionTree



#Regression.Tree MSE
RegressionTree.MSE &lt;- mean((observed - predict)^2)

#Median Regression MSE
MedianRegression.MSE &lt;- mean(bodyfat_rpart_qrm_summary$residuals^2)

df &lt;- data.frame(
  RegressionTree.MSE,
  MedianRegression.MSE
)

cat(&quot;MSE of both models&quot;)</code></pre>
<pre><code>## MSE of both models</code></pre>
<pre class="r"><code>df</code></pre>
<pre><code>##   RegressionTree.MSE MedianRegression.MSE
## 1            10.1705              15.0245</code></pre>
<pre class="r"><code>cat(&quot;Based on this, pruned regression tree has lower MSE than median regression model&quot;)</code></pre>
<pre><code>## Based on this, pruned regression tree has lower MSE than median regression model</code></pre>
<pre class="r"><code>cat(&quot;Plot based on the regression tree prunning&quot;)</code></pre>
<pre><code>## Plot based on the regression tree prunning</code></pre>
<pre class="r"><code>plot(as.party(bodyfat_prune), tp_args = list(id=FALSE), main = &quot;Plot based on the regression tree prunning&quot;)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>cat(
  &quot;Based on the above pruned tree, the variables waist circumference and hip circumference splits explain the majority of the data and I will be choosing one of these variables for quantile regression.&quot;
)</code></pre>
<pre><code>## Based on the above pruned tree, the variables waist circumference and hip circumference splits explain the majority of the data and I will be choosing one of these variables for quantile regression.</code></pre>
<pre class="r"><code>cat(&quot;Additionally, I will check with linear regression for the variable with significant effect&quot;)</code></pre>
<pre><code>## Additionally, I will check with linear regression for the variable with significant effect</code></pre>
<pre class="r"><code>check.lm &lt;- lm(DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + kneebreadth, data = bodyfat)

summary(check.lm)</code></pre>
<pre><code>## 
## Call:
## lm(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
##     kneebreadth, data = bodyfat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.1782 -2.4973  0.2089  2.5496 11.6504 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -59.57320    8.45359  -7.047 1.43e-09 ***
## age            0.06381    0.03740   1.706   0.0928 .  
## waistcirc      0.32044    0.07372   4.347 4.96e-05 ***
## hipcirc        0.43395    0.09566   4.536 2.53e-05 ***
## elbowbreadth  -0.30117    1.21731  -0.247   0.8054    
## kneebreadth    1.65381    0.86235   1.918   0.0595 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.988 on 65 degrees of freedom
## Multiple R-squared:  0.8789, Adjusted R-squared:  0.8696 
## F-statistic: 94.34 on 5 and 65 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>cat(&quot;Looks like waistcirc is the most significant, so we will choose this variable&quot;)</code></pre>
<pre><code>## Looks like waistcirc is the most significant, so we will choose this variable</code></pre>
<pre class="r"><code>cat(&quot;Now we can run a median quantile regression&quot;)</code></pre>
<pre><code>## Now we can run a median quantile regression</code></pre>
<pre class="r"><code>bodyfat_qrm_25 &lt;- rq(DEXfat ~ age + waistcirc, data = bodyfat, tau = 0.25)
summary(bodyfat_qrm_25)</code></pre>
<pre><code>## 
## Call: rq(formula = DEXfat ~ age + waistcirc, tau = 0.25, data = bodyfat)
## 
## tau: [1] 0.25
## 
## Coefficients:
##             coefficients lower bd  upper bd 
## (Intercept) -34.95268    -41.72329 -30.15887
## age           0.07777      0.01124   0.14609
## waistcirc     0.67033      0.60935   0.74444</code></pre>
<pre class="r"><code>bodyfat_qrm_50 &lt;- rq(DEXfat ~ age + waistcirc, data = bodyfat, tau = 0.50)
summary(bodyfat_qrm_50)</code></pre>
<pre><code>## Warning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be nonunique</code></pre>
<pre><code>## 
## Call: rq(formula = DEXfat ~ age + waistcirc, tau = 0.5, data = bodyfat)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             coefficients lower bd  upper bd 
## (Intercept) -28.39189    -39.03217 -17.59073
## age           0.05514     -0.06704   0.15053
## waistcirc     0.63962      0.54298   0.76936</code></pre>
<pre class="r"><code>bodyfat_qrm_75 &lt;- rq(DEXfat ~ age + waistcirc, data = bodyfat, tau = 0.75)
summary(bodyfat_qrm_50)</code></pre>
<pre><code>## Warning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be nonunique</code></pre>
<pre><code>## 
## Call: rq(formula = DEXfat ~ age + waistcirc, tau = 0.5, data = bodyfat)
## 
## tau: [1] 0.5
## 
## Coefficients:
##             coefficients lower bd  upper bd 
## (Intercept) -28.39189    -39.03217 -17.59073
## age           0.05514     -0.06704   0.15053
## waistcirc     0.63962      0.54298   0.76936</code></pre>
<pre class="r"><code>cat(&quot;DEXfat explained by waist circumference at quantile 25%, 50%, and 75% regression lines&quot;)</code></pre>
<pre><code>## DEXfat explained by waist circumference at quantile 25%, 50%, and 75% regression lines</code></pre>
<pre class="r"><code>plot(data=bodyfat, DEXfat~waistcirc, main=&quot;baseR: Quantile regression- DEXfat Explained by waist circumference&quot;, xlab=&#39;Waist circumference&#39;)
abline(rq(DEXfat ~ waistcirc, data=bodyfat, tau = 0.25), col=&#39;blue&#39;)
abline(rq(DEXfat ~ waistcirc, data=bodyfat, tau = 0.50), col=&#39;green&#39;)
abline(rq(DEXfat ~ waistcirc, data=bodyfat, tau = 0.75), col=&#39;black&#39;)
legend(&#39;topleft&#39;, legend = c(&#39;25% Quantile&#39;, &#39;50% Quantile&#39;, &#39;75% Quantile&#39;),
       fill=c(&#39;blue&#39;,&#39;green&#39;,&#39;black&#39;))</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<pre class="r"><code>ggplot(data=bodyfat, aes(x=waistcirc, y=DEXfat)) + geom_point() + stat_quantile(quantiles=c(0.25), method=&#39;rq&#39;, aes(colour=&#39;25%&#39;)) + stat_quantile(quantiles=c(0.50), method=&#39;rq&#39;, aes(colour=&#39;50%&#39;)) + 
  stat_quantile(quantiles=c(0.75), method=&#39;rq&#39;, aes(colour=&#39;75%&#39;)) +
  labs(title=&quot;ggplot: Quantile regression- DEXfat Explained by waist circumference&quot;, x=&#39;Waist circumference&#39;, y=&#39;DEXfat&#39;) +
scale_color_manual(name=&quot;Quantile Percent&quot;, values = c(&#39;25%&#39; = &quot;blue&quot;, &#39;50%&#39; = &quot;green&quot;, &#39;75%&#39; = &quot;black&quot;))</code></pre>
<pre><code>## Smoothing formula not specified. Using: y ~ x</code></pre>
<pre><code>## Smoothing formula not specified. Using: y ~ x
## Smoothing formula not specified. Using: y ~ x</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-2-4.png" width="672" /></p>
<p>Discussion:</p>
<p>Based on the above pruned tree, the variables waist circumference and hip circumference splits explain the majority of the data and I chose waist circumference for quantile regression. Based on this analysis, pruned regression tree has lower MSE than median regression model. The relationship of Dexfat to Age by Waist Circumference, all three quantiles regression lines have a positive, and seemingly similar slopes.</p>
<ol start="3" style="list-style-type: decimal">
<li>Consider {} data from the lecture notes (package {}). Refit the additive quantile regression models presented ({}) with varying values of <span class="math inline">\(\lambda\)</span> (lambda) in {}. How do the estimated quantile curves change?</li>
</ol>
<pre class="r"><code>#Q3 - db data from gamlss.data package
data(db)
head(db)</code></pre>
<pre><code>##   head  age
## 1 33.6 0.03
## 2 33.6 0.04
## 3 33.7 0.04
## 4 35.0 0.04
## 5 36.1 0.04
## 6 36.6 0.05</code></pre>
<pre class="r"><code>dim(db)</code></pre>
<pre><code>## [1] 7040    2</code></pre>
<pre class="r"><code>tau &lt;- c(.03, .15, .5, .85, .97)


cat(&quot;Parameters: lambda = 0&quot;)</code></pre>
<pre><code>## Parameters: lambda = 0</code></pre>
<pre class="r"><code>rqssmod &lt;- vector(mode = &quot;list&quot;, length = length(tau))
db$lage &lt;- with(db, age^(1/3))
for (i in 1:length(tau))
  rqssmod[[i]] &lt;- rqss(head ~ qss(lage, lambda = 0), data = db, tau = tau[i])

gage &lt;- seq(from = min(db$age), to = max(db$age), length = 50)
p &lt;- sapply(1:length(tau), function(i) { predict(rqssmod[[i]], newdata = data.frame(lage = gage^(1/3)))
})

pfun &lt;- function(x, y, ...) {
  panel.xyplot(x = x, y = y, ...)
  apply(p, 2, function(x) panel.lines(gage, x))
  panel.text(rep(max(db$age), length(tau)),
             p[nrow(p),], label = tau, cex = 0.9)
}

xyplot(head ~ age, data = db, main = &quot;Head circumference curve with lambda = 0&quot;,
       xlab = &quot;Age (years)&quot;, ylab = &quot;Head circumference (cm)&quot;, pch = 19,
       scales = list(x = list(relation = &quot;free&quot;)),
       layout = c(1, 1), col = rgb(.1, .1, .1, .1),
       panel = pfun)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>cat(&quot;Parameters: lambda = 1; and tau same as before&quot;)</code></pre>
<pre><code>## Parameters: lambda = 1; and tau same as before</code></pre>
<pre class="r"><code>rqssmod &lt;- vector(mode = &quot;list&quot;, length = length(tau))
db$lage &lt;- with(db, age^(1/3))
for (i in 1:length(tau))
  rqssmod[[i]] &lt;- rqss(head ~ qss(lage, lambda = 1), data = db, tau = tau[i])

gage &lt;- seq(from = min(db$age), to = max(db$age), length = 50)
p &lt;- sapply(1:length(tau), function(i) { predict(rqssmod[[i]], newdata = data.frame(lage = gage^(1/3)))
})

pfun &lt;- function(x, y, ...) {
  panel.xyplot(x = x, y = y, ...)
  apply(p, 2, function(x) panel.lines(gage, x))
  panel.text(rep(max(db$age), length(tau)),
             p[nrow(p),], label = tau, cex = 0.9)
}

xyplot(head ~ age, data = db, main = &quot;Head circumference curve with lambda=1&quot;,
       xlab = &quot;Age (years)&quot;, ylab = &quot;Head circumference (cm)&quot;, pch = 19,
       scales = list(x = list(relation = &quot;free&quot;)),
       layout = c(1, 1), col = rgb(.1, .1, .1, .1),
       panel = pfun)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>cat(&quot;Parameters: lambda = 20; and tau same as before&quot;)</code></pre>
<pre><code>## Parameters: lambda = 20; and tau same as before</code></pre>
<pre class="r"><code>rqssmod &lt;- vector(mode = &quot;list&quot;, length = length(tau))
db$lage &lt;- with(db, age^(1/3))
for (i in 1:length(tau))
  rqssmod[[i]] &lt;- rqss(head ~ qss(lage, lambda = 20), data = db, tau = tau[i])

gage &lt;- seq(from = min(db$age), to = max(db$age), length = 50)
p &lt;- sapply(1:length(tau), function(i) { predict(rqssmod[[i]], newdata = data.frame(lage = gage^(1/3)))
})

pfun &lt;- function(x, y, ...) {
  panel.xyplot(x = x, y = y, ...)
  apply(p, 2, function(x) panel.lines(gage, x))
  panel.text(rep(max(db$age), length(tau)),
             p[nrow(p),], label = tau, cex = 0.9)
}

xyplot(head ~ age, data = db, main = &quot;Head circumference curve with lambda=20&quot;,
       xlab = &quot;Age (years)&quot;, ylab = &quot;Head circumference (cm)&quot;, pch = 19,
       scales = list(x = list(relation = &quot;free&quot;)),
       layout = c(1, 1), col = rgb(.1, .1, .1, .1),
       panel = pfun)</code></pre>
<p><img src="/achalneupane.github.io/post/Quantile_Regression_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<p>Discussion:</p>
<p>Here, lambda acts as a shinkage factor which causes the quantiles to become smoother (at higher lambda) rather than becoming wavy or rough with lower values of labda (lambda = 0). So, I found that by increasing the penalty term lambda, which is assigned to the slope of the coefficients, the overall fit of the additive quantile regression model can be smoothen.</p>
<ol start="4" style="list-style-type: decimal">
<li>Read the paper by Koenker and Hallock (2001), posted on D2L. Write a one page summary of the paper. This should include but not be limited to introduction, motivation, case study considered and findings.</li>
</ol>
<p>Answer:</p>
<p>Introduction</p>
<p>In Koenker and Hallock (2001), the authors discuss the utility of quantile regression. In this study, they made a comparison on linear regression and quantile regression analyses.The quantile regression allows large sample groups or population size to into fractals distribution or smaller quantiles represented by a parameter <span class="math inline">\(\tau\)</span> (tau) and maintaining the same <span class="math inline">\(\tau\)</span> for observations above and below the quantile and minimizing the sum of weighted absolute residuals. They show the utility of quantile regression by looking at various types of data sets such as household food spending on household income and child birthweight.</p>
<p>Motivation</p>
<p>The reason to look at these data sets was to illustrate and explain that in some situations, quantile regression is more useful than linear regression. Quantile regression, which measures the median rather than the mean, will yield more suitable fits to results when a distribution includes outliers that could force the mean in a specific direction. This was addressed in the paper when referring to the’ Quantile Engel Curves’ where two different points of high income and low food consumption influenced the least square estimate. Quantile regression could eliminate this type of bias by minimizing the sum of absolute residuals.</p>
<p>Case study</p>
<p>The Infant Birth weight case study aimed to analyze the association between low birth weights of children and several variables including public policy measures. Infants weighing less than 5 pounds, 9 ounces at birth (2500 grams) were defined as low birth weight. Quantile regression was relevant in this analysis because due to the lower tail of the birth weight distribution, all the least square estimates had been skewed.</p>
<p>Findings</p>
<p>The most notable finding was that, based on the least square calculation, boys were usually born heavier than girls by 100 grams. The figure, however, changes with the quantile of 0.05, where boys were only 45 grams larger and even greater at the quantile of 095, where boys were 130 grams larger. The least squares (linear regression) in this case does a poor job of explaining the distribution variability. Additionally, infants born to black and white mothers with 5th percentile birth weights differed by 1/3 of a kilogram. Furthermore, the age of mother, education beyond high school, prenatal care, marital status, and smoking all contribute to the birth weight of an infant.</p>
<p>Conclusion</p>
<p>In conclusion, some distributions with longer tails can weigh the mean so that the regression of the least squares can provide a false representation of the results. A more precise description of the data and underlying patterns can be obtained using quantile regression. This is particularly useful in econometrics where there are often large outliers that can have a significant impact on a least squares model. Basically, we need to assess our needs when dealing with the datasets:
i. Are we concerned about percentiles or median value?
ii. Whether we are interested in average values and minimizing the residuals errors.</p>

    </div>

    


    

<div class="article-tags">
  
  <a class="badge badge-light" href="/achalneupane.github.io/tags/r/">R</a>
  
  <a class="badge badge-light" href="/achalneupane.github.io/tags/statistics/">Statistics</a>
  
  <a class="badge badge-light" href="/achalneupane.github.io/tags/modern-applied-statistics-i/">Modern Applied Statistics I</a>
  
</div>



    
      








  
  
    
  
  





  
  
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="/achalneupane.github.io/authors/achal-neupane/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/achalneupane.github.io/post/survival_analysis/">Survival Analysis</a></li>
          
          <li><a href="/achalneupane.github.io/post/generalized_additive_models_and_spline_models/">Generalized Additive Models and Spline Models</a></li>
          
          <li><a href="/achalneupane.github.io/post/logistic_regression_glm_ii/">Logistic Regression&amp;GLM-II</a></li>
          
          <li><a href="/achalneupane.github.io/post/logistic_regression_glm_i/">Logistic Regression&amp;GLM-I</a></li>
          
          <li><a href="/achalneupane.github.io/post/graphical_summary/">Graphical Summary</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/achalneupane.github.io/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/achalneupane.github.io/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/achalneupane.github.io/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/achalneupane.github.io/terms/">Terms</a>
        
  </p>
  

  <p class="powered-by">
    &copy; 2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
